# MCP Development Environment - Active Configuration

## Summary
This document describes the currently running MCP development environment to avoid port conflicts and resource collisions with other projects. It includes configuration details, management commands, and troubleshooting guidance.

**Purpose:** Local MCP development environment with Docker, an Nginx reverse proxy, and example MCP servers.

---

## Prerequisites

- WSL2 (recommended) or a Linux/macOS environment
- Docker & Docker Compose (or Docker Desktop)
- Git
- `mkcert` (for local TLS certificate generation) — optional but recommended
- curl (for quick testing)

---

## Project Structure

- `docker-compose.yml` — service definitions for `nginx` and example MCP servers
- `nginx/` — Nginx Dockerfile, `nginx.conf`, and `conf.d/mcp-servers.conf`
- `servers/santa-clara/` — example Flask MCP server, `Dockerfile`, `requirements.txt`, tests
- `certs/` — TLS certs generated by `mkcert` (local dev only)
- `scripts/` — helper scripts (e.g., `scripts/test.sh`)
- `logs/diagnostics/` — saved logs and diagnostic outputs collected during setup
- `Makefile` — convenient targets for management
- `SETUP_COMPLETE.md` — detailed setup summary and Claude Desktop instructions

---

## Docker Containers Running

### Container 1: Nginx Reverse Proxy
- **Container name:** `mcp-dev-environment-nginx-1`
- **Image:** Custom nginx:alpine
- **Network:** `mcp-network` (bridge, subnet: 172.28.0.0/16)
- **Status:** Running

### Container 2: Santa Clara MCP Server
- **Container name:** `mcp-dev-environment-santa-clara-1`
- **Image:** Custom Python Flask app
- **Network:** `mcp-network` (bridge, subnet: 172.28.0.0/16)
- **Status:** Running

---

## Port Usage

### Host Ports (Exposed to Windows/WSL)
- **8443** - HTTPS (Nginx reverse proxy with SSL/TLS)
  - Bound to: `127.0.0.1:8443` (localhost only)
  - Protocol: HTTPS (self-signed certificate via mkcert)
  - Endpoints:
    - `https://localhost:8443/` - Root endpoint
    - `https://localhost:8443/health` - Health check
    - `https://localhost:8443/santa-clara/*` - Santa Clara MCP routes

### Container Internal Ports (Not exposed to host)
- **443** - Nginx internal HTTPS listener (inside nginx container)
- **80** - Nginx internal HTTP listener (inside nginx container)
- **8000** - Santa Clara MCP server (inside santa-clara container)

**No other host ports are in use by this environment.**

---

## Network Configuration

### Docker Network
- **Network name:** `mcp-network`
- **Driver:** bridge
- **Subnet:** 172.28.0.0/16
- **Scope:** Local to this docker-compose project

### DNS/Hostnames (Internal to Docker network)
- `nginx` - Resolves to nginx container
- `santa-clara` - Resolves to santa-clara-mcp container

---

## File System Usage

### WSL Paths
- **Project root:** `~/mcp-dev-environment`
- **Logs:** `~/mcp-dev-environment/logs/`
- **Certificates:** `~/mcp-dev-environment/certs/`
- **Data:** `~/mcp-dev-environment/data/`

### Docker Volumes
- Named volumes: `mcp-dev-environment_logs`, `mcp-dev-environment_data`
- Bind mounts:
  - `./certs:/etc/nginx/certs:ro` (nginx container)
  - `./logs:/var/log/nginx` (nginx container)
  - `./logs:/app/logs` (santa-clara container)

---

## Resource Limits

### Santa Clara MCP Container
- **CPU:** 1.0 core limit
- **Memory:** 2GB limit

### Nginx Container
- **CPU:** No limit
- **Memory:** No limit

---

## Management Commands

### Make Targets
All available `Makefile` targets:

- `make start` — build and start the stack (detached)
- `make stop` — stop and remove containers
- `make restart` — restart the stack
- `make logs` — follow compose logs
- `make test` — run the example server tests (pytest)
- `make health` — quick HTTP health check against the proxy

### Example Usage
```bash
make start   # Start all services
make stop    # Stop all services
make restart # Restart all services
make logs    # Follow logs
make test    # Run tests
make health  # Health check
```

### Manual Verification
```bash
docker compose ps                    # Container status
curl -k https://localhost:8443/      # Test root endpoint
curl -k https://localhost:8443/health # Health check
```

---

## Avoiding Conflicts

### When Starting Other Projects:

**Ports to avoid:**
- ❌ **8443** - Already in use by MCP nginx proxy

**Safe ports to use:**
- ✅ **3000-8442** - Available
- ✅ **8444-9000** - Available
- ✅ **9001+** - Available

**Docker networks to avoid:**
- ❌ **mcp-network**
- ❌ **Subnet 172.28.0.0/16**

**Safe networks:**
- ✅ Create your own bridge network with different subnet (e.g., 172.29.0.0/16)

**Container names to avoid:**
- ❌ `mcp-dev-environment-*`
- ❌ `santa-clara-*`

---

## Testing the Environment

Unit tests for the example server are in `servers/santa-clara/tests/` and can be run with:

```bash
make test
```

You can also manually verify endpoints via curl as shown in the Management Commands section.

---

## Connecting Claude Desktop

To point Claude Desktop (or another local client) at this MCP proxy:

1. Configure the client's endpoint to `https://localhost:8443/`
2. Either trust the mkcert CA in the client environment, or set client to skip TLS verification for development
3. See `SETUP_COMPLETE.md` for an example `claude_desktop_config.json` snippet and Windows paths

---

## Adding More MCP Servers

To add a new MCP server:

1. Create a new folder under `servers/<your-service>` with a `Dockerfile`, app code, and tests
2. Add a service entry in `docker-compose.yml` for your service
3. Add a proxy rule in `nginx/conf.d/mcp-servers.conf` mapping a prefix or hostname to your service
4. Rebuild and restart the stack:

```bash
make build
make restart
```

---

## Troubleshooting

**Port conflicts:** If host port `8443` is in use, edit `.env` to change `HTTPS_PORT` and restart.

**Certificates:** If TLS issues occur, regenerate local certs with:
```bash
mkcert -install
mkcert localhost 127.0.0.1 ::1
```
Then place the files in `certs/`.

**Docker errors:** Ensure Docker daemon is running and you have permission to run docker commands.

**Container startup issues:** Inspect logs with:
```bash
make logs
# or
docker compose logs --tail 200
```

Saved diagnostic logs (from setup) are under `logs/diagnostics/`.

---

## Quick Reference

**Is MCP environment running?**
```bash
docker compose -f ~/mcp-dev-environment/docker-compose.yml ps
```

**Stop MCP environment temporarily:**
```bash
cd ~/mcp-dev-environment && make stop
```

**Restart MCP environment:**
```bash
cd ~/mcp-dev-environment && make start
```

---

## GitHub Repository
- **URL:** https://github.com/jcornell3/mcp-dev-environment
- **Branch:** main
- **Visibility:** Public

---

## Last Updated
November 29, 2025
