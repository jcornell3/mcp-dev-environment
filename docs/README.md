# MCP Dev Environment

Local MCP development environment with Docker and example MCP servers integrated with Claude Desktop.

## Description

This repository provides a local development stack for building and testing MCP (Model Context Protocol) servers. It includes:
- An example MCP server (`servers/santa-clara`) implemented with the MCP Python SDK using stdio transport.
- Direct stdio communication with Claude Desktop via `wsl docker exec`.
- A `docker-compose.yml` file to run the stack along with a `Makefile` for convenience.
- Complete documentation and setup guides for MCP server development.

Use this repo to build and test MCP servers locally, integrate with Claude Desktop, and iterate on implementations.

**Note:** This project was migrated from HTTP-based Flask servers to stdio-based MCP Python SDK servers for proper Claude Desktop integration.

## Prerequisites

- **Windows**: WSL2 with Docker Desktop (or Docker in WSL)
- **macOS/Linux**: Docker & Docker Compose
- Git
- For testing: curl or similar tool for sending JSON-RPC requests

## Quick Start

Clone and start the stack:

```bash
git clone git@github.com:USERNAME/mcp-dev-environment.git
cd mcp-dev-environment
make start
```

This will build images and start the `santa-clara` MCP server.

Test the MCP server via stdio:

```bash
# Test initialize (handshake)
echo '{"jsonrpc":"2.0","method":"initialize","params":{"protocolVersion":"2025-06-18","capabilities":{},"clientInfo":{"name":"test","version":"1.0"}},"id":1}' | docker exec -i mcp-dev-environment-santa-clara-1 python -u /app/server.py

# Test tools/list
echo '{"jsonrpc":"2.0","method":"tools/list","id":2}' | docker exec -i mcp-dev-environment-santa-clara-1 python -u /app/server.py

# Test tools/call
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get_property_info","arguments":{"apn":"123-456-789"}},"id":3}' | docker exec -i mcp-dev-environment-santa-clara-1 python -u /app/server.py
```

All requests should return valid MCP JSON-RPC 2.0 responses.

## Project Structure

- `docker-compose.yml` — service definitions for example MCP servers
- `servers/santa-clara/` — example MCP server using MCP Python SDK, `Dockerfile`, `requirements.txt`
- `docs/` — comprehensive documentation:
  - `DOCUMENTATION_INDEX.md` — navigation guide for all documentation
  - `FRESH_WORKSTATION_SETUP.md` — detailed setup procedures
  - `MCP_SERVER_DEVELOPMENT_GUIDE.md` — guide for implementing MCP servers
  - `MCP_DEVELOPMENT_LESSONS_LEARNED.md` — insights from implementation
  - `CLAUDE.md` — active configuration reference
- `certs/` — TLS certs generated by `mkcert` (optional, for local dev)
- `nginx/` — Nginx configuration (optional, for local dev)
- `scripts/` — helper scripts
- `Makefile` — convenient targets for management
- `claude_desktop_config.json` — Claude Desktop MCP server configuration

## Make commands

Available `Makefile` targets:

- `make start` — build and start the stack (detached)
- `make stop` — stop and remove containers
- `make restart` — restart the stack
- `make logs` — follow compose logs
- `make test` — run the example server tests (pytest)
- `make health` — quick HTTP health check against the proxy

Example usage:

```bash
make start
make logs
make stop
```

## Testing the environment

- Unit tests for the example server are in `servers/santa-clara/tests/` and can be run with:

```bash
make test
```

- Manually verify endpoints via curl as shown in Quick Start.

## Connecting Claude Desktop

To use the santa-clara MCP server with Claude Desktop:

1. Copy `claude_desktop_config.json` to your Claude Desktop config directory:
   - **Windows**: `C:\Users\<username>\AppData\Roaming\Claude\claude_desktop_config.json`
   - **macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
   - **Linux**: `~/.config/Claude/claude_desktop_config.json`

2. The config uses `wsl docker exec` to communicate directly with the stdio-based MCP server.

3. Restart Claude Desktop completely for changes to take effect.

For detailed setup instructions, see `docs/FRESH_WORKSTATION_SETUP.md`.

## Adding more MCP servers

To add a new MCP server:

1. Create a new folder under `servers/<your-service>` with a `Dockerfile`, app code, and tests.
2. Implement your MCP server using the MCP Python SDK with stdio transport (see `docs/MCP_SERVER_DEVELOPMENT_GUIDE.md`).
3. Add a service entry in `docker-compose.yml` for your service.
4. Update `claude_desktop_config.json` to register your new MCP server.
5. Rebuild and restart the stack:

```bash
docker compose build
docker compose restart
```

## Troubleshooting

- **Docker errors**: Ensure Docker daemon is running and you have permission to run docker commands.
- **Container won't start**: Check logs with:

```bash
docker compose logs santa-clara --tail 50
```

- **Claude Desktop not connecting**:
  - Verify container is running: `docker compose ps`
  - Verify correct container name in `claude_desktop_config.json`
  - Restart Claude Desktop completely
  - Check that WSL can access Docker: `wsl docker ps`

- **MCP requests timing out**: Ensure the container is fully started before sending requests. Use a small sleep before testing:

```bash
docker compose up -d
sleep 3
echo '{"jsonrpc":"2.0","method":"initialize",...}' | docker exec -i mcp-dev-environment-santa-clara-1 python -u /app/server.py
```

For detailed troubleshooting and setup information, see the documentation in `docs/`.

## License

This project is provided under the MIT License. See `LICENSE`.
