# MCP Dev Environment

Local MCP development environment with Docker, an Nginx reverse proxy, and example MCP servers.

## Description

This repository provides a small, local development stack for experimenting with MCP (mock control plane) servers and routing. It includes:
- An Nginx reverse proxy that terminates TLS (using `mkcert`) and forwards requests to backend MCP servers.
- An example MCP server (`servers/santa-clara`) implemented with Flask + Gunicorn.
- A `docker-compose.yml` file to run the stack along with a `Makefile` for convenience.

Use this repo to prototype locally, test integrations (for example Claude Desktop), and iterate on MCP server implementations.

## Prerequisites

- WSL2 (recommended) or a Linux/macOS environment
- Docker & Docker Compose (or Docker Desktop)
- Git
- `mkcert` (for local TLS certificate generation) — optional but recommended
- curl (for quick testing)

## Quick Start

Clone and start the stack:

```bash
git clone git@github.com:jcornell3/mcp-dev-environment.git
cd mcp-dev-environment
make start
```

This will build images and start the `nginx` and `santa-clara` services. Nginx will listen on host port `8443` for TLS.

Test endpoints:

```bash
curl -sSk https://localhost:8443/
curl -sSk https://localhost:8443/health
```

Both should return JSON responses from the example server.

## Project Structure

- `docker-compose.yml` — service definitions for `nginx` and example MCP servers
- `nginx/` — Nginx Dockerfile, `nginx.conf`, and `conf.d/mcp-servers.conf`
- `servers/santa-clara/` — example Flask MCP server, `Dockerfile`, `requirements.txt`, tests
- `certs/` — TLS certs generated by `mkcert` (local dev only)
- `scripts/` — helper scripts (e.g., `scripts/test.sh`)
- `logs/diagnostics/` — saved logs and diagnostic outputs collected during setup
- `Makefile` — convenient targets for management
- `SETUP_COMPLETE.md` — detailed setup summary and Claude Desktop instructions

## Make commands

Available `Makefile` targets:

- `make start` — build and start the stack (detached)
- `make stop` — stop and remove containers
- `make restart` — restart the stack
- `make logs` — follow compose logs
- `make test` — run the example server tests (pytest)
- `make health` — quick HTTP health check against the proxy

Example usage:

```bash
make start
make logs
make stop
```

## Testing the environment

- Unit tests for the example server are in `servers/santa-clara/tests/` and can be run with:

```bash
make test
```

- Manually verify endpoints via curl as shown in Quick Start.

## Connecting Claude Desktop

To point Claude Desktop (or another local client) at this MCP proxy:

1. Configure the client's endpoint to `https://localhost:8443/`.
2. Either trust the mkcert CA in the client environment, or set client to skip TLS verification for development.
3. See `SETUP_COMPLETE.md` for an example `claude_desktop_config.json` snippet and Windows paths.

## Adding more MCP servers

To add a new MCP server:

1. Create a new folder under `servers/<your-service>` with a `Dockerfile`, app code, and tests.
2. Add a service entry in `docker-compose.yml` for your service.
3. Add a proxy rule in `nginx/conf.d/mcp-servers.conf` mapping a prefix or hostname to your service.
4. Rebuild and restart the stack:

```bash
make build
make restart
```

## Troubleshooting

- Port conflicts: If host port `8443` is in use, edit `.env` to change `HTTPS_PORT` and restart.
- Certificates: If TLS issues occur, regenerate local certs with `mkcert -install` and `mkcert localhost 127.0.0.1 ::1` and place the files in `certs/`.
- Docker errors: Ensure Docker daemon is running and you have permission to run docker commands.
- If containers fail to start, inspect logs:

```bash
make logs
# or
docker compose logs --tail 200
```

Saved diagnostic logs (from setup) are under `logs/diagnostics/`.

## License

This project is provided under the MIT License. See `LICENSE`.
